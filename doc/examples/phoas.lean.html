<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Parametric Higher-Order Abstract Syntax - Lean Manual</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../alectryon.css">
        <link rel="stylesheet" href="../pygments.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme && theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar && sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../whatIsLean.html"><strong aria-hidden="true">1.</strong> What is Lean</a></li><li class="chapter-item "><a href="../tour.html"><strong aria-hidden="true">2.</strong> Tour of Lean</a></li><li class="chapter-item "><a href="../quickstart.html"><strong aria-hidden="true">3.</strong> Setting Up Lean</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../setup.html"><strong aria-hidden="true">3.1.</strong> Extended Setup Notes</a></li></ol></li><li class="chapter-item "><a href="../tpil.html"><strong aria-hidden="true">4.</strong> Theorem Proving in Lean</a></li><li class="chapter-item "><a href="../fplean.html"><strong aria-hidden="true">5.</strong> Functional Programming in Lean</a></li><li class="chapter-item expanded "><a href="../examples.html"><strong aria-hidden="true">6.</strong> Examples</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../examples/palindromes.lean.html"><strong aria-hidden="true">6.1.</strong> Palindromes</a></li><li class="chapter-item "><a href="../examples/bintree.lean.html"><strong aria-hidden="true">6.2.</strong> Binary Search Trees</a></li><li class="chapter-item "><a href="../examples/tc.lean.html"><strong aria-hidden="true">6.3.</strong> A Certified Type Checker</a></li><li class="chapter-item "><a href="../examples/interp.lean.html"><strong aria-hidden="true">6.4.</strong> The Well-Typed Interpreter</a></li><li class="chapter-item "><a href="../examples/deBruijn.lean.html"><strong aria-hidden="true">6.5.</strong> Dependent de Bruijn Indices</a></li><li class="chapter-item expanded "><a href="../examples/phoas.lean.html" class="active"><strong aria-hidden="true">6.6.</strong> Parametric Higher-Order Abstract Syntax</a></li></ol></li><li class="chapter-item "><li class="part-title">Language Manual</li><li class="chapter-item "><a href="../organization.html"><strong aria-hidden="true">7.</strong> Organizational features</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../sections.html"><strong aria-hidden="true">7.1.</strong> Sections</a></li><li class="chapter-item "><a href="../namespaces.html"><strong aria-hidden="true">7.2.</strong> Namespaces</a></li><li class="chapter-item "><a href="../implicit.html"><strong aria-hidden="true">7.3.</strong> Implicit Arguments</a></li><li class="chapter-item "><a href="../autobound.html"><strong aria-hidden="true">7.4.</strong> Auto Bound Implicit Arguments</a></li></ol></li><li class="chapter-item "><a href="../syntax.html"><strong aria-hidden="true">8.</strong> Syntax Extensions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../do.html"><strong aria-hidden="true">8.1.</strong> The do Notation</a></li><li class="chapter-item "><a href="../stringinterp.html"><strong aria-hidden="true">8.2.</strong> String Interpolation</a></li><li class="chapter-item "><a href="../notation.html"><strong aria-hidden="true">8.3.</strong> User-Defined Notation</a></li><li class="chapter-item "><a href="../macro_overview.html"><strong aria-hidden="true">8.4.</strong> Macro Overview</a></li><li class="chapter-item "><a href="../elaborators.html"><strong aria-hidden="true">8.5.</strong> Elaborators</a></li><li class="chapter-item "><a href="../syntax_examples.html"><strong aria-hidden="true">8.6.</strong> Examples</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../syntax_example.html"><strong aria-hidden="true">8.6.1.</strong> Balanced Parentheses</a></li><li class="chapter-item "><a href="../metaprogramming-arith.html"><strong aria-hidden="true">8.6.2.</strong> Arithmetic DSL</a></li></ol></li></ol></li><li class="chapter-item "><a href="../decltypes.html"><strong aria-hidden="true">9.</strong> Declaring New Types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../enum.html"><strong aria-hidden="true">9.1.</strong> Enumerated Types</a></li><li class="chapter-item "><a href="../inductive.html"><strong aria-hidden="true">9.2.</strong> Inductive Types</a></li><li class="chapter-item "><a href="../struct.html"><strong aria-hidden="true">9.3.</strong> Structures</a></li><li class="chapter-item "><a href="../typeclass.html"><strong aria-hidden="true">9.4.</strong> Type classes</a></li><li class="chapter-item "><a href="../unifhint.html"><strong aria-hidden="true">9.5.</strong> Unification Hints</a></li></ol></li><li class="chapter-item "><a href="../builtintypes.html"><strong aria-hidden="true">10.</strong> Builtin Types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../nat.html"><strong aria-hidden="true">10.1.</strong> Natural number</a></li><li class="chapter-item "><a href="../int.html"><strong aria-hidden="true">10.2.</strong> Integer</a></li><li class="chapter-item "><a href="../uint.html"><strong aria-hidden="true">10.3.</strong> Fixed precision unsigned integer</a></li><li class="chapter-item "><a href="../float.html"><strong aria-hidden="true">10.4.</strong> Float</a></li><li class="chapter-item "><a href="../array.html"><strong aria-hidden="true">10.5.</strong> Array</a></li><li class="chapter-item "><a href="../list.html"><strong aria-hidden="true">10.6.</strong> List</a></li><li class="chapter-item "><a href="../char.html"><strong aria-hidden="true">10.7.</strong> Character</a></li><li class="chapter-item "><a href="../string.html"><strong aria-hidden="true">10.8.</strong> String</a></li><li class="chapter-item "><a href="../option.html"><strong aria-hidden="true">10.9.</strong> Option</a></li><li class="chapter-item "><a href="../thunk.html"><strong aria-hidden="true">10.10.</strong> Thunk</a></li><li class="chapter-item "><a href="../task.html"><strong aria-hidden="true">10.11.</strong> Task and Thread</a></li></ol></li><li class="chapter-item "><a href="../functions.html"><strong aria-hidden="true">11.</strong> Functions</a></li><li class="chapter-item "><a href="../monads/intro.html"><strong aria-hidden="true">12.</strong> Monads</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../monads/functors.lean.html"><strong aria-hidden="true">12.1.</strong> Functor</a></li><li class="chapter-item "><a href="../monads/applicatives.lean.html"><strong aria-hidden="true">12.2.</strong> Applicative</a></li><li class="chapter-item "><a href="../monads/monads.lean.html"><strong aria-hidden="true">12.3.</strong> Monad</a></li><li class="chapter-item "><a href="../monads/readers.lean.html"><strong aria-hidden="true">12.4.</strong> Reader</a></li><li class="chapter-item "><a href="../monads/states.lean.html"><strong aria-hidden="true">12.5.</strong> State</a></li><li class="chapter-item "><a href="../monads/except.lean.html"><strong aria-hidden="true">12.6.</strong> Except</a></li><li class="chapter-item "><a href="../monads/transformers.lean.html"><strong aria-hidden="true">12.7.</strong> Transformers</a></li><li class="chapter-item "><a href="../monads/laws.lean.html"><strong aria-hidden="true">12.8.</strong> Laws</a></li></ol></li><li class="chapter-item "><li class="part-title">Other</li><li class="chapter-item "><a href="../faq.html"><strong aria-hidden="true">13.</strong> Frequently Asked Questions</a></li><li class="chapter-item "><a href="../lean3changes.html"><strong aria-hidden="true">14.</strong> Significant Changes from Lean 3</a></li><li class="chapter-item "><a href="../syntax_highlight_in_latex.html"><strong aria-hidden="true">15.</strong> Syntax Highlighting Lean in LaTeX</a></li><li class="chapter-item "><a href="../examples/widgets.lean.html"><strong aria-hidden="true">16.</strong> User Widgets</a></li><li class="chapter-item "><a href="../semantic_highlighting.html"><strong aria-hidden="true">17.</strong> Semantic Highlighting</a></li><li class="chapter-item affix "><li class="part-title">Development</li><li class="chapter-item "><a href="../dev/index.html"><strong aria-hidden="true">18.</strong> Development Guide</a></li><li class="chapter-item "><a href="../make/index.html"><strong aria-hidden="true">19.</strong> Building Lean</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../make/ubuntu.html"><strong aria-hidden="true">19.1.</strong> Ubuntu Setup</a></li><li class="chapter-item "><a href="../make/osx-10.9.html"><strong aria-hidden="true">19.2.</strong> macOS Setup</a></li><li class="chapter-item "><a href="../make/msys2.html"><strong aria-hidden="true">19.3.</strong> Windows MSYS2 Setup</a></li><li class="chapter-item "><a href="../make/wsl.html"><strong aria-hidden="true">19.4.</strong> Windows with WSL</a></li></ol></li><li class="chapter-item "><a href="../dev/bootstrap.html"><strong aria-hidden="true">20.</strong> Bootstrapping</a></li><li class="chapter-item "><a href="../dev/testing.html"><strong aria-hidden="true">21.</strong> Testing</a></li><li class="chapter-item "><a href="../dev/debugging.html"><strong aria-hidden="true">22.</strong> Debugging</a></li><li class="chapter-item "><a href="../dev/commit_convention.html"><strong aria-hidden="true">23.</strong> Commit Convention</a></li><li class="chapter-item "><a href="../dev/mdbook.html"><strong aria-hidden="true">24.</strong> Building This Manual</a></li><li class="chapter-item "><a href="../dev/ffi.html"><strong aria-hidden="true">25.</strong> Foreign Function Interface</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Lean Manual</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/leanprover/lean4" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="parametric-higher-order-abstract-syntax"><a class="header" href="#parametric-higher-order-abstract-syntax">Parametric Higher-Order Abstract Syntax</a></h1>
<p>In contrast to first-order encodings, higher-order encodings avoid explicit modeling of variable identity.
Instead, the binding constructs of an object language (the language being
formalized) can be represented using the binding constructs of the meta language (the language in which the formalization is done).
The best known higher-order encoding is called higher-order abstract syntax (HOAS),
and we can start by attempting to apply it directly in Lean.</p>
<p>Remark: this example is based on an example in the book <a href="http://adam.chlipala.net/cpdt/">Certified Programming with Dependent Types</a> by Adam Chlipala.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --></pre>
<p>Here is the definition of the simple type system for our programming language, a simply typed
lambda calculus with natural numbers as the base type.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="kd">inductive</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div><span class="nv">Ty</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">where</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>fn</span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div><span class="nv">Ty</span></span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div><span class="nv">Ty</span></span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div><span class="nv">Ty</span></span><span class="alectryon-token"></span></span></pre>
<p>We can write a function to translate <code>Ty</code> values to a Lean type
— remember that types are first class, so can be calculated just like any other value.
We mark <code>Ty.denote</code> as <code>[reducible]</code> to make sure the typeclass resolution procedure can
unfold/reduce it. For example, suppose Lean is trying to synthesize a value for the instance
<code>Add (Ty.denote Ty.nat)</code>. Since <code>Ty.denote</code> is marked as <code>[reducible]</code>,
the typeclass resolution procedure can reduce <code>Ty.denote Ty.nat</code> to <code>Nat</code>, and use
the builtin instance for <code>Add Nat</code> as the solution.</p>
<p>Recall that the term <code>a.denote</code> is sugar for <code>denote a</code> where <code>denote</code> is the function being defined.
We call it the &quot;dot notation&quot;.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="kd">@[reducible]</span> </span><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.denote</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Ty.denote</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</span><span class="alectryon-token">    <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Nat</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Nat</span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>fn</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"><span class="bp">.</span></span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">denote</span></span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"><span class="bp">.</span></span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">denote</span></span><span class="alectryon-token"></span></span></pre>
<p>With HOAS, each object language binding construct is represented with a function of
the meta language. Here is what we get if we apply that idea within an inductive definition
of term syntax. However a naive encondig in Lean fails to meet the strict positivity restrictions
imposed by the Lean kernel. An alternate higher-order encoding is parametric HOAS, as introduced by Washburn
and Weirich for Haskell and tweaked by Adam Chlipala for use in Coq. The key idea is to parameterize the
declaration by a type family <code>rep</code> standing for a &quot;representation of variables.&quot;</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="kd">inductive</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></span><span class="alectryon-token">) : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div>var</span><span class="alectryon-token">   : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep Ty.nat</span></span></div></blockquote></div></small></div>const</span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Nat</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Nat</span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>nat</span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty → Type} → Term' rep Ty.nat → Term' rep Ty.nat → Term' rep Ty.nat</span></span></div></blockquote></div></small></div>plus</span><span class="alectryon-token">  : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>nat</span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>nat</span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>nat</span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → (rep dom → Term' rep ran) → Term' rep (Ty.fn dom ran)</span></span></div></blockquote></div></small></div>lam</span><span class="alectryon-token">   : (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>dom</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">dom</span></span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ran</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ran</span></span><span class="alectryon-token">) <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>fn</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>dom</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">dom</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ran</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ran</span></span><span class="alectryon-token">)
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → Term' rep (Ty.fn dom ran) → Term' rep dom → Term' rep ran</span></span></div></blockquote></div></small></div>app</span><span class="alectryon-token">   : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>fn</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>dom</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">dom</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ran</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ran</span></span><span class="alectryon-token">) <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>dom</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">dom</span></span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ran</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ran</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>let</var><b>: </b><span>{rep : Ty → Type} → {ty₁ ty₂ : Ty} → Term' rep ty₁ → (rep ty₁ → Term' rep ty₂) → Term' rep ty₂</span></span></div></blockquote></div></small></div><span class="k">let</span></span><span class="alectryon-token">   : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty₁</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty₁</span></span><span class="alectryon-token"> <span class="bp">→</span> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty₁</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty₁</span></span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty₂</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty₂</span></span><span class="alectryon-token">) <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty₂</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty₂</span></span><span class="alectryon-token"></span></span></pre>
<p>Lean accepts this definition because our embedded functions now merely take variables as
arguments, instead of arbitrary terms. One might wonder whether there is an easy loophole
to exploit here, instantiating the parameter <code>rep</code> as term itself. However, to do that, we
would need to choose a variable representation for this nested mention of term, and so on
through an infinite descent into term arguments.</p>
<p>We write the final type of a closed term using polymorphic quantification over all possible
choices of <code>rep</code> type family</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="kn">open</span></span><span class="alectryon-token"> Ty (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>fn</span><span class="alectryon-token">)

</span><span class="alectryon-token"><span class="kn">namespace</span></span><span class="alectryon-token"> FirstTry

</span><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty → Type 1</span></span></div></blockquote></div></small></div><span class="nv">Term</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</span><span class="alectryon-token">) := (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></span><span class="alectryon-token">) <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div>Term&#39;</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token"></span></span></pre>
<p>In the next two example, note how each is written as a function over a <code>rep</code> choice,
such that the specific choice has no impact on the structure of the term.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>add</var><b>: </b><span>Term (fn nat (fn nat nat))</span></span></div></blockquote></div></small></div><span class="nv">add</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty → Type 1</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>fn</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>fn</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</span><span class="alectryon-token">)) := </span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>_rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">_rep</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span>
  </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.lam</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → (rep dom → Term' rep ran) → Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div><span class="bp">.</span>lam</span><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>_rep nat</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.lam</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → (rep dom → Term' rep ran) → Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div><span class="bp">.</span>lam</span><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>y</var><b>: </b><span>_rep nat</span></span></div></blockquote></div></small></div><span class="nv">y</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.plus</var><b>: </b><span>{rep : Ty → Type} → Term' rep nat → Term' rep nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>plus</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>_rep nat</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>y</var><b>: </b><span>_rep nat</span></span></div></blockquote></div></small></div><span class="nv">y</span></span><span class="alectryon-token">)

</span><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>three_the_hard_way</var><b>: </b><span>Term nat</span></span></div></blockquote></div></small></div><span class="nv">three_the_hard_way</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty → Type 1</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</span><span class="alectryon-token"> := </span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span>
  </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.app</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → Term' rep (fn dom ran) → Term' rep dom → Term' rep ran</span></span></div></blockquote></div></small></div><span class="bp">.</span>app</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.app</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → Term' rep (fn dom ran) → Term' rep dom → Term' rep ran</span></span></div></blockquote></div></small></div><span class="bp">.</span>app</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>add</var><b>: </b><span>Term (fn nat (fn nat nat))</span></span></div></blockquote></div></small></div>add</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></span><span class="alectryon-token">)) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>2</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">2</span></span><span class="alectryon-token">)

</span><span class="alectryon-token"><span class="kd">end</span></span><span class="alectryon-token"> FirstTry</span></span></pre>
<p>The argument <code>rep</code> does not even appear in the function body for <code>add</code>. How can that be?
By giving our terms expressive types, we allow Lean to infer many arguments for us. In fact,
we do not even need to name the <code>rep</code> argument! By using Lean implicit arguments and lambdas,
we can completely hide <code>rep</code> in these examples.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty → Type 1</span></span></div></blockquote></div></small></div><span class="nv">Term</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</span><span class="alectryon-token">) := {</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></span><span class="alectryon-token">} <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div>Term&#39;</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token">

</span><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>add</var><b>: </b><span>Term (fn nat (fn nat nat))</span></span></div></blockquote></div></small></div><span class="nv">add</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty → Type 1</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>fn</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>fn</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</span><span class="alectryon-token">)) :=
  </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.lam</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → (rep dom → Term' rep ran) → Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div><span class="bp">.</span>lam</span><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep✝ nat</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.lam</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → (rep dom → Term' rep ran) → Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div><span class="bp">.</span>lam</span><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>y</var><b>: </b><span>rep✝ nat</span></span></div></blockquote></div></small></div><span class="nv">y</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.plus</var><b>: </b><span>{rep : Ty → Type} → Term' rep nat → Term' rep nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>plus</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep✝ nat</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>y</var><b>: </b><span>rep✝ nat</span></span></div></blockquote></div></small></div><span class="nv">y</span></span><span class="alectryon-token">)

</span><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>three_the_hard_way</var><b>: </b><span>Term nat</span></span></div></blockquote></div></small></div><span class="nv">three_the_hard_way</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty → Type 1</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</span><span class="alectryon-token"> :=
  </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.app</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → Term' rep (fn dom ran) → Term' rep dom → Term' rep ran</span></span></div></blockquote></div></small></div><span class="bp">.</span>app</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.app</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → Term' rep (fn dom ran) → Term' rep dom → Term' rep ran</span></span></div></blockquote></div></small></div><span class="bp">.</span>app</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>add</var><b>: </b><span>Term (fn nat (fn nat nat))</span></span></div></blockquote></div></small></div>add</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></span><span class="alectryon-token">)) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>2</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">2</span></span><span class="alectryon-token">)</span></span></pre>
<p>It may not be at all obvious that the PHOAS representation admits the crucial computable
operations. The key to effective deconstruction of PHOAS terms is one principle: treat
the <code>rep</code> parameter as an unconstrained choice of which data should be annotated on each
variable. We will begin with a simple example, that of counting how many variable nodes
appear in a PHOAS term. This operation requires no data annotated on variables, so we
simply annotate variables with <code>Unit</code> values. Note that, when we go under binders in the
cases for <code>lam</code> and <code>let</code>, we must provide the data value to annotate on the new variable we
pass beneath. For our current choice of <code>Unit</code> data, we always pass <code>()</code>.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; Unit) ty → Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div>Term&#39;</span><span class="alectryon-token"> (</span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>_</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>_</span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Unit</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Unit</span><span class="alectryon-token">) </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Nat</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Nat</span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> _    <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> _  <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>0</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">0</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.plus</var><b>: </b><span>{rep : Ty → Type} → Term' rep nat → Term' rep nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>plus</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; Unit) nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' (fun x =&gt; Unit) nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; Unit) ty → Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; Unit) nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> <span class="bp">+</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; Unit) ty → Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' (fun x =&gt; Unit) nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.app</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → Term' rep (fn dom ran) → Term' rep dom → Term' rep ran</span></span></div></blockquote></div></small></div><span class="bp">.</span>app</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' (fun x =&gt; Unit) (fn dom✝ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; Unit) dom✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; Unit) ty → Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' (fun x =&gt; Unit) (fn dom✝ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> <span class="bp">+</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; Unit) ty → Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; Unit) dom✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.lam</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → (rep dom → Term' rep ran) → Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div><span class="bp">.</span>lam</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Unit → Term' (fun x =&gt; Unit) ran✝</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token">    <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; Unit) ty → Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Unit → Term' (fun x =&gt; Unit) ran✝</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>()</var><b>: </b><span>Unit</span></span></div></blockquote></div></small></div>()</span><span class="alectryon-token">)
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.let</var><b>: </b><span>{rep : Ty → Type} → {ty₁ ty₂ : Ty} → Term' rep ty₁ → (rep ty₁ → Term' rep ty₂) → Term' rep ty₂</span></span></div></blockquote></div></small></div><span class="bp">.</span><span class="k">let</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; Unit) ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Unit → Term' (fun x =&gt; Unit) ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; Unit) ty → Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; Unit) ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> <span class="bp">+</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; Unit) ty → Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Unit → Term' (fun x =&gt; Unit) ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>()</var><b>: </b><span>Unit</span></span></div></blockquote></div></small></div>()</span><span class="alectryon-token">)</span></span></pre>
<p>We can now easily prove that <code>add</code> has two variables by using reflexivity</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>example</var><b>: </b><span>countVars add = 2</span></span></div></blockquote></div></small></div><span class="kd">example</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; Unit) ty → Nat</span></span></div></blockquote></div></small></div>countVars</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>add</var><b>: </b><span>Term (fn nat (fn nat nat))</span></span></div></blockquote></div></small></div>add</span><span class="alectryon-token"> <span class="bp">=</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>2</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">2</span></span><span class="alectryon-token"> :=
  </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rfl</var><b>: </b><span>∀ {α : Type} {a : α}, a = a</span></span></div></blockquote></div></small></div>rfl</span><span class="alectryon-token"></span></span></pre>
<p>Here is another example, translating PHOAS terms into strings giving a first-order rendering.
To implement this translation, the key insight is to tag variables with strings, giving their names.
The function takes as an additional input <code>i</code> which is used to create variable names for binders.
We also use the string interpolation available in Lean. For example, <code>s!&quot;x_{i}&quot;</code> is expanded to
<code>&quot;x_&quot; ++ toString i</code>.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; String) ty → optParam Nat 1 → String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' (fun x =&gt; String) ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div>Term&#39;</span><span class="alectryon-token"> (</span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>_</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>_</span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>String</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>String</span><span class="alectryon-token">) </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Nat</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Nat</span><span class="alectryon-token"> := </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></span><span class="alectryon-token">) : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>String</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>String</span><span class="alectryon-token"> :=
  </span><span class="alectryon-token"><span class="k">match</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' (fun x =&gt; String) ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">with</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>s</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">s</span></span><span class="alectryon-token">     <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>s</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">s</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">   <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>toString</var><b>: </b><span>{α : Type} → [self : ToString α] → α → String</span></span></div></blockquote></div></small></div>toString</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.app</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → Term' rep (fn dom ran) → Term' rep dom → Term' rep ran</span></span></div></blockquote></div></small></div><span class="bp">.</span>app</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' (fun x =&gt; String) (fn dom✝ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; String) dom✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">   <span class="bp">=&gt;</span> </span><span class="alectryon-token">s<span class="bp">!</span></span><span class="alectryon-token"><span class="s2">&quot;({</span></span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; String) ty → optParam Nat 1 → String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' (fun x =&gt; String) (fn dom✝ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></span><span class="alectryon-token">} {</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; String) ty → optParam Nat 1 → String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; String) dom✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></span><span class="alectryon-token">})<span class="s2">&quot;</span>
<span class="s2">  |</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.plus</var><b>: </b><span>{rep : Ty → Type} → Term' rep nat → Term' rep nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>plus</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; String) nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' (fun x =&gt; String) nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span> </span><span class="alectryon-token">s<span class="bp">!</span></span><span class="alectryon-token"><span class="s2">&quot;({</span></span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; String) ty → optParam Nat 1 → String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; String) nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></span><span class="alectryon-token">} <span class="bp">+</span> {</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; String) ty → optParam Nat 1 → String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' (fun x =&gt; String) nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></span><span class="alectryon-token">})<span class="s2">&quot;</span>
<span class="s2">  |</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.lam</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → (rep dom → Term' rep ran) → Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div><span class="bp">.</span>lam</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>String → Term' (fun x =&gt; String) ran✝</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token">     <span class="bp">=&gt;</span>
    </span><span class="alectryon-token"><span class="k">let</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token"> := </span><span class="alectryon-token">s<span class="bp">!</span></span><span class="alectryon-token"><span class="s2">&quot;x_{</span></span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></span><span class="alectryon-token">}<span class="s2">&quot;</span>
    </span><span class="alectryon-token">s<span class="bp">!</span></span><span class="alectryon-token"><span class="s2">&quot;(fun {</span></span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">} <span class="bp">=&gt;</span> {</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; String) ty → optParam Nat 1 → String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>String → Term' (fun x =&gt; String) ran✝</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></span><span class="alectryon-token"><span class="bp">+</span></span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></span><span class="alectryon-token">)})<span class="s2">&quot;</span>
<span class="s2">  |</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.let</var><b>: </b><span>{rep : Ty → Type} → {ty₁ ty₂ : Ty} → Term' rep ty₁ → (rep ty₁ → Term' rep ty₂) → Term' rep ty₂</span></span></div></blockquote></div></small></div><span class="bp">.</span><span class="k">let</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; String) ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>String → Term' (fun x =&gt; String) ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span>
    </span><span class="alectryon-token"><span class="k">let</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token"> := </span><span class="alectryon-token">s<span class="bp">!</span></span><span class="alectryon-token"><span class="s2">&quot;x_{</span></span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></span><span class="alectryon-token">}<span class="s2">&quot;</span>
    </span><span class="alectryon-token">s<span class="bp">!</span></span><span class="alectryon-token"><span class="s2">&quot;(let {</span></span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">} := {</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; String) ty → optParam Nat 1 → String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; String) ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></span><span class="alectryon-token">}<span class="bp">;</span> <span class="bp">=&gt;</span> {</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; String) ty → optParam Nat 1 → String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>String → Term' (fun x =&gt; String) ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></span><span class="alectryon-token"><span class="bp">+</span></span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></span><span class="alectryon-token">)}<span class="s2">&quot;</span>

</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="phoas-lean-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="phoas-lean-chk0"><span class="alectryon-token"><span class="k">#eval</span></span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message"><span class="s2">&quot;(((fun x_1 =&gt; (fun x_2 =&gt; (x_1 + x_2))) 1) 2)&quot;</span>
</blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; String) ty → optParam Nat 1 → String</span></span></div></blockquote></div></small></div>pretty</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>three_the_hard_way</var><b>: </b><span>Term nat</span></span></div></blockquote></div></small></div>three_the_hard_way</span><span class="alectryon-token"></span></span></pre>
<p>It is not necessary to convert to a different representation to support many common
operations on terms. For instance, we can implement substitution of terms for variables.
The key insight here is to tag variables with terms, so that, on encountering a variable, we
can simply replace it by the term in its tag. We will call this function initially on a term
with exactly one free variable, tagged with the appropriate substitute. During recursion,
new variables are added, but they are only tagged with their own term equivalents. Note
that this function squash is parameterized over a specific <code>rep</code> choice.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' (Term' rep) ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div>Term&#39;</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div>Term&#39;</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token">) </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div>Term&#39;</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token">
 <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></span><span class="alectryon-token">    <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></span><span class="alectryon-token">
 <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">
 <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.plus</var><b>: </b><span>{rep : Ty → Type} → Term' rep nat → Term' rep nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>plus</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (Term' rep) nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' (Term' rep) nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.plus</var><b>: </b><span>{rep : Ty → Type} → Term' rep nat → Term' rep nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>plus</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' (Term' rep) ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (Term' rep) nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' (Term' rep) ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' (Term' rep) nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token">)
 <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.lam</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → (rep dom → Term' rep ran) → Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div><span class="bp">.</span>lam</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' rep dom✝ → Term' (Term' rep) ran✝</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token">    <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.lam</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → (rep dom → Term' rep ran) → Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div><span class="bp">.</span>lam</span><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep dom✝</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' (Term' rep) ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' rep dom✝ → Term' (Term' rep) ran✝</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep dom✝</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">))
 <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.app</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → Term' rep (fn dom ran) → Term' rep dom → Term' rep ran</span></span></div></blockquote></div></small></div><span class="bp">.</span>app</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' (Term' rep) (fn dom✝ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (Term' rep) dom✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.app</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → Term' rep (fn dom ran) → Term' rep dom → Term' rep ran</span></span></div></blockquote></div></small></div><span class="bp">.</span>app</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' (Term' rep) ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' (Term' rep) (fn dom✝ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' (Term' rep) ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (Term' rep) dom✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">)
 <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.let</var><b>: </b><span>{rep : Ty → Type} → {ty₁ ty₂ : Ty} → Term' rep ty₁ → (rep ty₁ → Term' rep ty₂) → Term' rep ty₂</span></span></div></blockquote></div></small></div><span class="bp">.</span><span class="k">let</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (Term' rep) ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' rep ty₁✝ → Term' (Term' rep) ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.let</var><b>: </b><span>{rep : Ty → Type} → {ty₁ ty₂ : Ty} → Term' rep ty₁ → (rep ty₁ → Term' rep ty₂) → Term' rep ty₂</span></span></div></blockquote></div></small></div><span class="bp">.</span><span class="k">let</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' (Term' rep) ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (Term' rep) ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">) </span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' (Term' rep) ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' rep ty₁✝ → Term' (Term' rep) ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">))</span></span></pre>
<p>To define the final substitution function over terms with single free variables, we define
<code>Term1</code>, an analogue to Term that we defined before for closed terms.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term1</var><b>: </b><span>Ty → Ty → Type 1</span></span></div></blockquote></div></small></div><span class="nv">Term1</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty1</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty1</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty2</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty2</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</span><span class="alectryon-token">) := {</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></span><span class="alectryon-token">} <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty1</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty1</span></span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div>Term&#39;</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty2</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty2</span></span><span class="alectryon-token"></span></span></pre>
<p>Substitution is defined by (1) instantiating a <code>Term1</code> to tag variables with terms and (2)
applying the result to a specific term to be substituted. Note how the parameter <code>rep</code> of
<code>squash</code> is instantiated: the body of <code>subst</code> is itself a polymorphic quantification over <code>rep</code>,
standing for a variable tag choice in the output term; and we use that input to compute a
tag choice for the input term.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>subst</var><b>: </b><span>{ty1 ty2 : Ty} → Term1 ty1 ty2 → Term ty1 → Term ty2</span></span></div></blockquote></div></small></div><span class="nv">subst</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term1 ty1 ty2</span></span></div></blockquote></div></small></div><span class="nv">e</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term1</var><b>: </b><span>Ty → Ty → Type 1</span></span></div></blockquote></div></small></div>Term1</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty1</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty1</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty2</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty2</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e'</var><b>: </b><span>Term ty1</span></span></div></blockquote></div></small></div><span class="nv">e&#39;</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty → Type 1</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty1</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty1</span></span><span class="alectryon-token">) : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty → Type 1</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty2</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty2</span></span><span class="alectryon-token"> :=
  </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' (Term' rep) ty → Term' rep ty</span></span></div></blockquote></div></small></div>squash</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term1 ty1 ty2</span></span></div></blockquote></div></small></div><span class="nv">e</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e'</var><b>: </b><span>Term ty1</span></span></div></blockquote></div></small></div><span class="nv">e&#39;</span></span><span class="alectryon-token">)</span></span></pre>
<p>We can view <code>Term1</code> as a term with hole. In the following example,
<code>(fun x =&gt; plus (var x) (const 5))</code> can be viewed as the term <code>plus _ (const 5)</code> where
the hole <code>_</code> is instantiated by <code>subst</code> with <code>three_the_hard_way</code></p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="phoas-lean-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="phoas-lean-chk1"><span class="alectryon-token"><span class="k">#eval</span></span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message"><span class="s2">&quot;((((fun x_1 =&gt; (fun x_2 =&gt; (x_1 + x_2))) 1) 2) + 5)&quot;</span>
</blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} → Term' (fun x =&gt; String) ty → optParam Nat 1 → String</span></span></div></blockquote></div></small></div>pretty</span><span class="alectryon-token"> <span class="bp">&lt;|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>subst</var><b>: </b><span>{ty1 ty2 : Ty} → Term1 ty1 ty2 → Term ty1 → Term ty2</span></span></div></blockquote></div></small></div>subst</span><span class="alectryon-token"> (</span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep✝ nat</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.plus</var><b>: </b><span>{rep : Ty → Type} → Term' rep nat → Term' rep nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>plus</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep✝ nat</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>5</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">5</span></span><span class="alectryon-token">)) </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>three_the_hard_way</var><b>: </b><span>Term nat</span></span></div></blockquote></div></small></div>three_the_hard_way</span><span class="alectryon-token"></span></span></pre>
<p>One further development, which may seem surprising at first,
is that we can also implement a usual term denotation function,
when we tag variables with their denotations.</p>
<p>The attribute <code>[simp]</code> instructs Lean to always try to unfold <code>denote</code> applications when one applies
the <code>simp</code> tactic. We also say this is a hint for the Lean term simplifier.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="bp">@</span>[</span><span class="alectryon-token"><span class="k">simp</span></span><span class="alectryon-token">] </span><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} → Term' Ty.denote ty → Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div>Term&#39;</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.denote</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div>Ty.denote</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token"><span class="bp">.</span></span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div>denote</span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">    <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.plus</var><b>: </b><span>{rep : Ty → Type} → Term' rep nat → Term' rep nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>plus</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' Ty.denote nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} → Term' Ty.denote ty → Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> <span class="bp">+</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} → Term' Ty.denote ty → Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' Ty.denote nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.app</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → Term' rep (fn dom ran) → Term' rep dom → Term' rep ran</span></span></div></blockquote></div></small></div><span class="bp">.</span>app</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' Ty.denote (fn dom✝ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote dom✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} → Term' Ty.denote ty → Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' Ty.denote (fn dom✝ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} → Term' Ty.denote ty → Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote dom✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">)
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.lam</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → (rep dom → Term' rep ran) → Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div><span class="bp">.</span>lam</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Ty.denote dom✝ → Term' Ty.denote ran✝</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token">    <span class="bp">=&gt;</span> </span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.denote dom✝</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} → Term' Ty.denote ty → Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Ty.denote dom✝ → Term' Ty.denote ran✝</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.denote dom✝</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">)
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.let</var><b>: </b><span>{rep : Ty → Type} → {ty₁ ty₂ : Ty} → Term' rep ty₁ → (rep ty₁ → Term' rep ty₂) → Term' rep ty₂</span></span></div></blockquote></div></small></div><span class="bp">.</span><span class="k">let</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Ty.denote ty₁✝ → Term' Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} → Term' Ty.denote ty → Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Ty.denote ty₁✝ → Term' Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} → Term' Ty.denote ty → Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">))

</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>example</var><b>: </b><span>denote three_the_hard_way = 3</span></span></div></blockquote></div></small></div><span class="kd">example</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} → Term' Ty.denote ty → Ty.denote ty</span></span></div></blockquote></div></small></div>denote</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>three_the_hard_way</var><b>: </b><span>Term nat</span></span></div></blockquote></div></small></div>three_the_hard_way</span><span class="alectryon-token"> <span class="bp">=</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>3</var><b>: </b><span>Ty.denote nat</span></span></div></blockquote></div></small></div><span class="mi">3</span></span><span class="alectryon-token"> :=
  </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rfl</var><b>: </b><span>∀ {α : Type} {a : α}, a = a</span></span></div></blockquote></div></small></div>rfl</span><span class="alectryon-token"></span></span></pre>
<p>To summarize, the PHOAS representation has all the expressive power of more
standard encodings (e.g., using de Bruijn indices), and a variety of translations are actually much more pleasant to
implement than usual, thanks to the novel ability to tag variables with data.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --></pre>
<p>We now define the constant folding optimization that traverses a term if replaces subterms such as
<code>plus (const m) (const n)</code> with <code>const (n+m)</code>.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="bp">@</span>[</span><span class="alectryon-token"><span class="k">simp</span></span><span class="alectryon-token">] </span><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div>Term&#39;</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div>Term&#39;</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep ty</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">    <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep ty</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.app</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → Term' rep (fn dom ran) → Term' rep dom → Term' rep ran</span></span></div></blockquote></div></small></div><span class="bp">.</span>app</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' rep (fn dom✝ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' rep dom✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.app</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → Term' rep (fn dom ran) → Term' rep dom → Term' rep ran</span></span></div></blockquote></div></small></div><span class="bp">.</span>app</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' rep (fn dom✝ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' rep dom✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">)
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.lam</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → (rep dom → Term' rep ran) → Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div><span class="bp">.</span>lam</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>rep dom✝ → Term' rep ran✝</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token">    <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.lam</var><b>: </b><span>{rep : Ty → Type} → {dom ran : Ty} → (rep dom → Term' rep ran) → Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div><span class="bp">.</span>lam</span><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep dom✝</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>rep dom✝ → Term' rep ran✝</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep dom✝</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">)
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.let</var><b>: </b><span>{rep : Ty → Type} → {ty₁ ty₂ : Ty} → Term' rep ty₁ → (rep ty₁ → Term' rep ty₂) → Term' rep ty₂</span></span></div></blockquote></div></small></div><span class="bp">.</span><span class="k">let</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' rep ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>rep ty₁✝ → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token">  <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.let</var><b>: </b><span>{rep : Ty → Type} → {ty₁ ty₂ : Ty} → Term' rep ty₁ → (rep ty₁ → Term' rep ty₂) → Term' rep ty₂</span></span></div></blockquote></div></small></div><span class="bp">.</span><span class="k">let</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' rep ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">) </span><span class="alectryon-token"><span class="k">fun</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>rep ty₁✝ → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep ty₁✝</span></span></div></blockquote></div></small></div><span class="nv">x</span></span><span class="alectryon-token">)
  <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.plus</var><b>: </b><span>{rep : Ty → Type} → Term' rep nat → Term' rep nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>plus</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span>
    </span><span class="alectryon-token"><span class="k">match</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' rep ty → Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">with</span></span><span class="alectryon-token">
    <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>m</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">m</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.const</var><b>: </b><span>{rep : Ty → Type} → Nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>const</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token"><span class="bp">+</span></span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>m</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">m</span></span><span class="alectryon-token">)
    <span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a'</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">a&#39;</span></span><span class="alectryon-token">,       </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b'</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">b&#39;</span></span><span class="alectryon-token">       <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.plus</var><b>: </b><span>{rep : Ty → Type} → Term' rep nat → Term' rep nat → Term' rep nat</span></span></div></blockquote></div></small></div><span class="bp">.</span>plus</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a'</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">a&#39;</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b'</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">b&#39;</span></span><span class="alectryon-token"></span></span></pre>
<p>The correctness of the <code>constFold</code> is proved using induction, case-analysis, and the term simplifier.
We prove all cases but the one for <code>plus</code> using <code>simp [*]</code>. This tactic instructs the term simplifier to
use hypotheses such as <code>a = b</code> as rewriting/simplications rules.
We use the <code>split</code> to break the nested <code>match</code> expression in the <code>plus</code> case into two cases.
The local variables <code>iha</code> and <code>ihb</code> are the induction hypotheses for <code>a</code> and <code>b</code>.
The modifier <code>←</code> in a term simplifier argument instructs the term simplifier to use the equation as a rewriting rule in
the &quot;reverse direction. That is, given <code>h : a = b</code>, <code>← h</code> instructs the term simplifier to rewrite <code>b</code> subterms to <code>a</code>.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token"><span class="kd">theorem</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold_sound</var><b>: </b><span>∀ {ty : Ty} (e : Term' Ty.denote ty), denote (constFold e) = denote e</span></span></div></blockquote></div></small></div><span class="nv">constFold_sound</span></span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty → Type) → Ty → Type</span></span></div></blockquote></div></small></div>Term&#39;</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.denote</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div>Ty.denote</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></span><span class="alectryon-token">) : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} → Term' Ty.denote ty → Ty.denote ty</span></span></div></blockquote></div></small></div>denote</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty → Type} → {ty : Ty} → Term' rep ty → Term' rep ty</span></span></div></blockquote></div></small></div>constFold</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></span><span class="alectryon-token">) <span class="bp">=</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} → Term' Ty.denote ty → Ty.denote ty</span></span></div></blockquote></div></small></div>denote</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></span><span class="alectryon-token"> := </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="phoas-lean-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="phoas-lean-chk2"><span class="alectryon-token"><span class="kd">by</span></span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">Goals accomplished<span class="bp">!</span> <span class="bp">🐙</span></div></blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token">
  </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="phoas-lean-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="phoas-lean-chk3"><span class="alectryon-token"><span class="k">induction</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">with</span></span><span class="alectryon-token"></span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote ty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">denote (constFold e) <span class="bp">=</span> denote e</div></blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="phoas-lean-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="phoas-lean-chk4"><span class="alectryon-token"><span class="k">simp</span></span><span class="alectryon-token"> [<span class="bp">*</span>]</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">Goals accomplished<span class="bp">!</span> <span class="bp">🐙</span></div></blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token">
  </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="phoas-lean-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="phoas-lean-chk5"><span class="alectryon-token"><span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty → Type} → Term' rep nat → Term' rep nat → Term' rep nat</span></span></div></blockquote></div></small></div>plus</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' Ty.denote nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>iha</var><b>: </b><span>denote (constFold a) = denote a</span></span></div></blockquote></div></small></div><span class="nv">iha</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ihb</var><b>: </b><span>denote (constFold b) = denote b</span></span></div></blockquote></div></small></div><span class="nv">ihb</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span></span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>iha</var><span class="hyp-type"><b>: </b><span>denote (constFold a) <span class="bp">=</span> denote a</span></span></span><br><span><var>ihb</var><span class="hyp-type"><b>: </b><span>denote (constFold b) <span class="bp">=</span> denote b</span></span></span><br></div><span class="goal-separator"><hr><span class="goal-name">plus</span></span><div class="goal-conclusion">denote
    (<span class="k">match</span> constFold a, constFold b <span class="k">with</span>
    <span class="bp">|</span> Term&#39;.const n, Term&#39;.const m <span class="bp">=&gt;</span> Term&#39;.const (n <span class="bp">+</span> m)
    <span class="bp">|</span> a&#39;, b&#39; <span class="bp">=&gt;</span> Term&#39;.plus a&#39; b&#39;) <span class="bp">=</span>
  denote a <span class="bp">+</span> denote b</div></blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token">
    </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="phoas-lean-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="phoas-lean-chk6"><span class="alectryon-token"><span class="k">split</span></span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>iha</var><span class="hyp-type"><b>: </b><span>denote (constFold a) <span class="bp">=</span> denote a</span></span></span><br><span><var>ihb</var><span class="hyp-type"><b>: </b><span>denote (constFold b) <span class="bp">=</span> denote b</span></span></span><br><span><var>x✝¹, x✝</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>n✝, m✝</var><span class="hyp-type"><b>: </b><span>Nat</span></span></span><br><span><var>heq✝¹</var><span class="hyp-type"><b>: </b><span>constFold a <span class="bp">=</span> Term&#39;.const n<span class="bp">✝</span></span></span></span><br><span><var>heq✝</var><span class="hyp-type"><b>: </b><span>constFold b <span class="bp">=</span> Term&#39;.const m<span class="bp">✝</span></span></span></span><br></div><span class="goal-separator"><hr><span class="goal-name">plus.h_1</span></span><div class="goal-conclusion">denote (Term&#39;.const (n<span class="bp">✝</span> <span class="bp">+</span> m<span class="bp">✝</span>)) <span class="bp">=</span> denote a <span class="bp">+</span> denote b</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="phoas-lean-chk7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>iha</var><span class="hyp-type"><b>: </b><span>denote (constFold a) <span class="bp">=</span> denote a</span></span></span><br><span><var>ihb</var><span class="hyp-type"><b>: </b><span>denote (constFold b) <span class="bp">=</span> denote b</span></span></span><br><span><var>x✝², x✝¹</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>x✝</var><span class="hyp-type"><b>: </b><span><span class="bp">∀</span> (n m : Nat), constFold a <span class="bp">=</span> Term&#39;.const n <span class="bp">→</span> constFold b <span class="bp">=</span> Term&#39;.const m <span class="bp">→</span> False</span></span></span><br></div><label class="goal-separator" for="phoas-lean-chk7"><hr><span class="goal-name">plus.h_2</span></label><div class="goal-conclusion">denote (Term&#39;.plus (constFold a) (constFold b)) <span class="bp">=</span> denote a <span class="bp">+</span> denote b</div></blockquote></div></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token">
    </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="phoas-lean-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="phoas-lean-chk8"><span class="alectryon-token"><span class="k">next</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>he₁</var><b>: </b><span>constFold a = Term'.const n✝</span></span></div></blockquote></div></small></div><span class="nv">he₁</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>he₂</var><b>: </b><span>constFold b = Term'.const m✝</span></span></div></blockquote></div></small></div><span class="nv">he₂</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span></span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>iha</var><span class="hyp-type"><b>: </b><span>denote (constFold a) <span class="bp">=</span> denote a</span></span></span><br><span><var>ihb</var><span class="hyp-type"><b>: </b><span>denote (constFold b) <span class="bp">=</span> denote b</span></span></span><br><span><var>x✝¹, x✝</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>n✝, m✝</var><span class="hyp-type"><b>: </b><span>Nat</span></span></span><br><span><var>heq✝¹</var><span class="hyp-type"><b>: </b><span>constFold a <span class="bp">=</span> Term&#39;.const n<span class="bp">✝</span></span></span></span><br><span><var>heq✝</var><span class="hyp-type"><b>: </b><span>constFold b <span class="bp">=</span> Term&#39;.const m<span class="bp">✝</span></span></span></span><br></div><span class="goal-separator"><hr><span class="goal-name">plus.h_1</span></span><div class="goal-conclusion">denote (Term&#39;.const (n<span class="bp">✝</span> <span class="bp">+</span> m<span class="bp">✝</span>)) <span class="bp">=</span> denote a <span class="bp">+</span> denote b</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="phoas-lean-chk9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>iha</var><span class="hyp-type"><b>: </b><span>denote (constFold a) <span class="bp">=</span> denote a</span></span></span><br><span><var>ihb</var><span class="hyp-type"><b>: </b><span>denote (constFold b) <span class="bp">=</span> denote b</span></span></span><br><span><var>x✝², x✝¹</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>x✝</var><span class="hyp-type"><b>: </b><span><span class="bp">∀</span> (n m : Nat), constFold a <span class="bp">=</span> Term&#39;.const n <span class="bp">→</span> constFold b <span class="bp">=</span> Term&#39;.const m <span class="bp">→</span> False</span></span></span><br></div><label class="goal-separator" for="phoas-lean-chk9"><hr><span class="goal-name">plus.h_2</span></label><div class="goal-conclusion">denote (Term&#39;.plus (constFold a) (constFold b)) <span class="bp">=</span> denote a <span class="bp">+</span> denote b</div></blockquote></div></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="phoas-lean-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="phoas-lean-chka"><span class="alectryon-token"><span class="k">simp</span></span><span class="alectryon-token"> [<span class="bp">←</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>iha</var><b>: </b><span>denote (constFold a) = denote a</span></span></div></blockquote></div></small></div><span class="nv">iha</span></span><span class="alectryon-token">, <span class="bp">←</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ihb</var><b>: </b><span>denote (constFold b) = denote b</span></span></div></blockquote></div></small></div><span class="nv">ihb</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>he₁</var><b>: </b><span>constFold a = Term'.const n✝</span></span></div></blockquote></div></small></div><span class="nv">he₁</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>he₂</var><b>: </b><span>constFold b = Term'.const m✝</span></span></div></blockquote></div></small></div><span class="nv">he₂</span></span><span class="alectryon-token">]</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">Goals accomplished<span class="bp">!</span> <span class="bp">🐙</span></div></blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token">
    </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="phoas-lean-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="phoas-lean-chkb"><span class="alectryon-token"><span class="k">next</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span></span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>iha</var><span class="hyp-type"><b>: </b><span>denote (constFold a) <span class="bp">=</span> denote a</span></span></span><br><span><var>ihb</var><span class="hyp-type"><b>: </b><span>denote (constFold b) <span class="bp">=</span> denote b</span></span></span><br><span><var>x✝², x✝¹</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>x✝</var><span class="hyp-type"><b>: </b><span><span class="bp">∀</span> (n m : Nat), constFold a <span class="bp">=</span> Term&#39;.const n <span class="bp">→</span> constFold b <span class="bp">=</span> Term&#39;.const m <span class="bp">→</span> False</span></span></span><br></div><span class="goal-separator"><hr><span class="goal-name">plus.h_2</span></span><div class="goal-conclusion">denote (Term&#39;.plus (constFold a) (constFold b)) <span class="bp">=</span> denote a <span class="bp">+</span> denote b</div></blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="phoas-lean-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="phoas-lean-chkc"><span class="alectryon-token"><span class="k">simp</span></span><span class="alectryon-token"> [</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>iha</var><b>: </b><span>denote (constFold a) = denote a</span></span></div></blockquote></div></small></div><span class="nv">iha</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ihb</var><b>: </b><span>denote (constFold b) = denote b</span></span></div></blockquote></div></small></div><span class="nv">ihb</span></span><span class="alectryon-token">]</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">Goals accomplished<span class="bp">!</span> <span class="bp">🐙</span></div></blockquote></div></div></small></span></pre>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../examples/deBruijn.lean.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../organization.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../examples/deBruijn.lean.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../organization.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../alectryon.js"></script>
    </body>
</html>
